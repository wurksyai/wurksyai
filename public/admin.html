<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wurksy Admin</title>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="icon" href="/logo.svg" />
    <script src="/theme.js" defer></script>
  </head>
  <body>
    <header>
      <nav class="nav">
        <a class="brand" href="/index.html">
          <img src="/logo.svg" alt="Wurksy AI logo" onerror="this.remove()" />
          <span class="brand-text">
            <span class="brand-name">Wurksy AI</span>
          </span>
        </a>
        <div class="links">
          <a href="/index.html">Chat</a>
          <a href="/lectures.html">Lectures</a>
          <a href="/research.html">Research</a>
          <a href="/admin.html" class="active">Admin</a>
          <a href="/demo.html">Demo</a>
          <a class="nav-link" href="/auth/logout" title="Sign out">Sign out</a>
          <button id="themeToggle" class="themebtn" type="button">☾</button>
        </div>
      </nav>
    </header>

    <main>
      <!-- Top admin key + status -->
      <section class="card">
        <div class="card-head">
          <h1>Wurksy Admin</h1>
          <div id="status" class="muted">Idle</div>
        </div>
        <div class="row" style="gap: 8px; flex-wrap: wrap">
          <input
            id="adminKey"
            type="text"
            placeholder="ADMIN_KEY"
            style="min-width: 180px"
          />
          <button id="saveKey" class="btn" type="button">Save key</button>
        </div>

        <!-- Tabs -->
        <div
          class="row"
          style="
            margin-top: 12px;
            gap: 6px;
            flex-wrap: wrap;
            border-top: 1px solid var(--border);
            padding-top: 10px;
          "
        >
          <button
            class="btn btn-pill tab-btn active"
            type="button"
            data-tab-btn="create"
          >
            Create assignment
          </button>
          <button
            class="btn btn-pill tab-btn"
            type="button"
            data-tab-btn="indexes"
          >
            View AI Index
          </button>
          <button
            class="btn btn-pill"
            type="button"
            data-tab-btn="analytics"
            disabled
            title="Coming soon"
          >
            Analytics (soon)
          </button>
        </div>
      </section>

      <!-- TAB 1: Create assignment (wizard-style) -->
      <section class="card" data-tab="create">
        <div class="card-head">
          <h2>Create new assignment</h2>
          <div class="muted">Step <span id="stepNum">1</span> of 3</div>
        </div>

        <!-- Step indicator -->
        <div
          class="row"
          style="
            gap: 8px;
            margin-bottom: 10px;
            font-size: 13px;
            align-items: center;
          "
        >
          <span id="stepLabel" class="muted">Basics</span>
        </div>

        <!-- Wizard steps -->
        <div class="row" style="gap: 16px">
          <!-- Step 1 -->
          <div class="row assignment-step" data-step="1">
            <label>
              Module code
              <input
                id="assModuleCode"
                type="text"
                placeholder="e.g. BS3201"
                required
              />
            </label>

            <label>
              Assignment title
              <input
                id="assTitle"
                type="text"
                placeholder="e.g. Analytical Project AI Sandbox"
                required
              />
            </label>
          </div>

          <!-- Step 2 -->
          <div class="row assignment-step" data-step="2" style="display: none">
            <label>
              Deadline (optional)
              <input
                id="assDeadline"
                type="datetime-local"
                placeholder="dd/mm/yyyy --:--"
              />
            </label>

            <label>
              Prompt cap per student (max 100)
              <input
                id="assPromptCap"
                type="number"
                min="1"
                max="100"
                value="100"
              />
              <span class="hint"
                >Students can send up to this many prompts for this
                assignment.</span
              >
            </label>
          </div>

          <!-- Step 3 -->
          <div class="row assignment-step" data-step="3" style="display: none">
            <label>
              Brief / instructions shown to students
              <textarea
                id="assBrief"
                rows="4"
                placeholder="Paste the assignment brief here so students see it at the top of Wurksy."
              ></textarea>
            </label>

            <label>
              Recommended PDFs (optional)
              <textarea
                id="assRecommended"
                rows="3"
                placeholder="One URL per line, or a short search hint. These show in the Research tab as ‘Recommended PDFs’."
              ></textarea>
            </label>

            <label>
              Lecture files (coming soon)
              <input type="file" multiple disabled />
              <span class="hint"
                >Lecture upload from Admin will be added later. For now, upload
                resources through the Lectures tab.</span
              >
            </label>
          </div>
        </div>

        <!-- Wizard navigation -->
        <div
          class="row"
          style="margin-top: 12px; justify-content: space-between; gap: 8px"
        >
          <button
            id="stepBack"
            class="btn"
            type="button"
            style="min-width: 80px"
          >
            Back
          </button>
          <div style="display: flex; gap: 8px">
            <button
              id="stepNext"
              class="btn btn-primary"
              type="button"
              style="min-width: 120px"
            >
              Next
            </button>
          </div>
        </div>

        <!-- Result box -->
        <div
          id="createdAssignmentInfo"
          class="card"
          style="margin-top: 16px; display: none"
        >
          <div class="card-head">
            <h3>Assignment created</h3>
          </div>
          <p class="muted">
            Share this Wurksy link with your students. It is unique to this
            assignment.
          </p>
          <code
            id="createdAssignmentLink"
            style="
              display: block;
              overflow-wrap: anywhere;
              margin-bottom: 8px;
              font-size: 13px;
            "
          ></code>
          <button
            id="copyCreatedAssignmentLink"
            class="btn btn-small"
            type="button"
          >
            Copy link
          </button>
        </div>
      </section>

      <!-- TAB 2: View AI Index -->
      <section class="card" data-tab="indexes" style="display: none">
        <div class="card-head">
          <h2>Student AI Indexes</h2>
          <p class="muted">
            Shows sessions where students logged in with an assignment link.
          </p>
        </div>

        <div class="row" style="gap: 8px; flex-wrap: wrap">
          <input
            id="sessionFilter"
            type="search"
            placeholder="Search by student ID, module, or assignment code…"
            style="flex: 1 1 220px"
          />
          <button id="refreshSessions" class="btn" type="button">
            Refresh
          </button>
        </div>

        <div style="margin-top: 10px; overflow-x: auto">
          <table class="table" style="min-width: 640px">
            <thead>
              <tr>
                <th>Student ID</th>
                <th>Module</th>
                <th>Assignment code</th>
                <th>Created</th>
                <th>Status</th>
                <th>AI Index</th>
              </tr>
            </thead>
            <tbody id="indexSessionRows">
              <!-- rows injected -->
            </tbody>
          </table>
        </div>
      </section>

      <!-- TAB 3: Analytics (placeholder) -->
      <section class="card" data-tab="analytics" style="display: none">
        <div class="card-head">
          <h2>Analytics</h2>
        </div>
        <p class="muted">
          Analytics (per-module usage, prompts per assignment, red flags) will
          be added here later.
        </p>
      </section>
    </main>

    <script type="module" src="/admin.js"></script>
  </body>
</html>
