<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wurksy AI</title>
    <link rel="stylesheet" href="/styles.css" />
    <script defer src="/theme.js"></script>

    <style>
      /* Message bullets */
      #msgs li {
        white-space: pre-wrap;
        user-select: none;
      }

      /* Modal styling */
      .modal-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.45);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }
      .modal-backdrop.show {
        display: flex;
      }
      .modal {
        width: min(680px, 92vw);
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 16px;
        box-shadow: var(--shadow);
      }

      /* Chat input bar */
      #send {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--card);
        border: 1px solid var(--border);
        padding: 10px 14px;
        border-radius: 28px;
        margin-top: 10px;
      }
      #send textarea {
        flex: 1;
        padding: 10px 4px;
        border: none;
        background: transparent;
        resize: none;
        max-height: 10em;
        line-height: 1.5;
        font-size: 16px;
      }

      /* Assignment box height (brief) */
      #assignmentCard {
        max-height: 480px;
        overflow: hidden;
      }
      #assignmentBrief {
        max-height: 360px;
        overflow-y: auto;
      }

      /* Hero title + logo */
      .hero-title {
        display: flex;
        align-items: center;
        gap: 0px;
      }
      .hero-logo {
        height: 48px;
        width: 48px;
        border-radius: 8px;
      }

      .cta {
        display: flex;
        gap: 12px;
        margin-top: 12px;
      }

      /* Recommended reading styles */
      .recommended-wrap {
        margin-top: 12px;
        border-top: 1px solid var(--border-subtle, var(--border));
        padding-top: 8px;
      }
      .recommended-wrap h4 {
        font-size: 13px;
        margin: 0 0 4px 0;
        text-transform: uppercase;
        letter-spacing: 0.04em;
      }
      .recommended-list {
        list-style: none;
        padding-left: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }
      .recommended-list .list-item a {
        font-size: 13px;
      }
    </style>
  </head>

  <body>
    <!-- Top nav -->
    <header>
      <nav class="nav">
        <a class="brand" href="/index.html">
          <img
            src="/logo.svg"
            alt="Wurksy AI logo"
            onerror="this.style.display='none'"
          />
          <span class="brand-text"
            ><span class="brand-name">Wurksy AI</span></span
          >
        </a>

        <div class="links">
          <a class="active" href="/index.html">Chat</a>
          <a href="/lectures.html">Lectures</a>
          <a href="/research.html">Research</a>
          <a href="/admin.html">Admin</a>
          <a href="/demo.html">Demo</a>
          <a class="nav-link" href="/auth/logout">Sign out</a>
          <button id="themeToggle" class="themebtn" title="Toggle theme">
            ☾
          </button>
        </div>
      </nav>
    </header>

    <main>
      <!-- Whole page stack: hero (with assignment meta), brief, chat -->
      <section class="assignment-layout">
        <!-- HERO with assignment meta on the right -->
        <div class="card hero-wrap hero-card">
          <div class="hero hero-row">
            <!-- Left: logo + title + buttons -->
            <div class="hero-main">
              <p class="badge">
                Amber-mode academic assistant • logs • caps • integrity
              </p>

              <h1 class="title-xl hero-title">
                <img src="/logo.svg" class="hero-logo" alt="Wurksy logo" />
                Wurksy <span class="gradient-text">AI</span>
              </h1>

              <div class="cta">
                <a id="startChatBtn" class="btn btn-primary" href="#chat">
                  Start Chat
                </a>
                <a class="btn" href="/lectures.html">Upload Lectures</a>
                <a class="btn" href="/research.html">Open Research</a>
              </div>
            </div>

            <!-- Right: assignment meta injected by app.js -->
            <aside id="assignmentHeader" class="assignment-meta"></aside>
          </div>
        </div>

        <!-- BRIEF CARD (single compact bubble) -->
        <section id="assignmentCard" class="card" style="display: none">
          <div id="assignmentBrief" class="muted brief-bubble"></div>

          <div class="recommended-wrap">
            <h4>Recommended reading</h4>
            <ul
              id="assignmentRecommended"
              class="recommended-list"
              aria-label="Recommended reading for this assignment"
            ></ul>
          </div>
        </section>

        <!-- CHAT CARD -->
        <section id="chat" class="card chat-wrap">
          <!-- Top row: title, privacy/terms, notes chip, cap on right -->
          <div class="chat-head">
            <h2>Chat (Amber Mode)</h2>

            <div class="chat-head-middle">
              <a class="link" href="/privacy.html" target="_blank">Privacy</a> •
              <a class="link" href="/terms.html" target="_blank"
                >Terms &amp; conditions</a
              >
            </div>

            <button
              type="button"
              class="notes-chip"
              onclick="document.getElementById('sessionNotes')?.focus()"
            >
              Optional notes (e.g. other AI tools used)
            </button>

            <div id="cap" class="cap muted"></div>
          </div>

          <!-- Notes textarea directly under header -->
          <div class="notes-row">
            <textarea
              id="sessionNotes"
              placeholder="Add any notes you want recorded in your AI Index..."
              rows="2"
            ></textarea>
            <p class="muted notes-hint">
              These notes are saved when you press
              <strong>Submit &amp; Lock</strong> and will appear in your AI
              Index.
            </p>
          </div>

          <ul id="msgs" aria-live="polite"></ul>

          <form id="send" autocomplete="off">
            <textarea
              id="input"
              placeholder="Ask Wurksy AI..."
              rows="1"
            ></textarea>
            <button type="submit" class="btn btn-primary">↑</button>
            <button id="makeIndex" type="button" class="btn">AI Index</button>
            <button id="submitBtn" type="button" class="btn">
              Submit &amp; Lock
            </button>
          </form>

          <p class="muted" style="margin-top: 10px">
            Replies are concise and logged. Once you press
            <strong>Submit &amp; Lock</strong>, the session closes.
          </p>
        </section>
      </section>
    </main>

    <!-- AI Declaration Modal -->
    <div id="declBackdrop" class="modal-backdrop">
      <div class="modal" role="dialog" aria-modal="true">
        <h3>AI Use Declaration (Amber-mode)</h3>
        <p class="muted">Tick all boxes to confirm correct use.</p>

        <div class="grid" style="margin: 8px 0">
          <label
            ><input type="checkbox" id="d_onlyWurksy" /> Wurksy was the only AI
            tool I used.</label
          >
          <label
            ><input type="checkbox" id="d_noGhost" /> I did not copy or
            “humanise” AI text.</label
          >
          <label
            ><input type="checkbox" id="d_independent" /> The final submission
            is my own work.</label
          >
          <label
            ><input type="checkbox" id="d_understand" /> I understand
            non-compliance = malpractice.</label
          >
        </div>

        <label style="display: block; margin: 6px 0">
          Assignment ID
          <input id="d_assgn" type="text" placeholder="StudentID_ModuleCode" />
        </label>

        <div class="actions">
          <button id="declCancel" class="btn">Cancel</button>
          <button id="declConfirm" class="btn btn-primary">
            Submit &amp; Lock
          </button>
        </div>
      </div>
    </div>

    <script src="/app.js" type="module"></script>
  </body>
</html>
