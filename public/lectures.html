<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Worksy AI — Lectures</title>
    <link rel="icon" href="/logo.svg" />
    <meta name="color-scheme" content="dark light" />
    <!-- Early theme apply to avoid mismatch -->
    <script>
      (function () {
        try {
          var t = localStorage.getItem("worksy-theme") || "dark";
          document.documentElement.dataset.theme = t;
          var m = document.querySelector('meta[name="color-scheme"]');
          if (m) m.content = t === "dark" ? "dark light" : "light dark";
        } catch {}
      })();
    </script>
    <link rel="stylesheet" href="/styles.css" />
    <style>
      :root {
        --sidebar-w: 320px;
        --chat-w: 380px;
        --toolbar-h: 52px;
      }
      body {
        margin: 0;
      }
      .layout {
        display: grid;
        grid-template-columns: var(--sidebar-w) 1fr var(--chat-w);
        grid-template-rows: auto 1fr;
        grid-template-areas:
          "topbar topbar topbar"
          "sidebar viewer chat";
        height: 100dvh;
      }
      header.topbar {
        grid-area: topbar;
      }
      /* Sidebar */
      aside.sidebar {
        grid-area: sidebar;
        border-right: 1px solid var(--border);
        padding: 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        overflow: hidden;
      }
      .field {
        display: flex;
        gap: 0.5rem;
      }
      .list {
        overflow: auto;
        border: 1px solid var(--border);
        border-radius: 10px;
      }
      .upload {
        border: 1px dashed var(--border);
        border-radius: 12px;
        padding: 0.75rem;
        display: grid;
        gap: 0.5rem;
      }
      .upload .row {
        display: flex;
        gap: 0.5rem;
      }
      /* Viewer */
      section.viewer {
        grid-area: viewer;
        display: grid;
        grid-template-rows: var(--toolbar-h) auto 1fr;
        overflow: hidden;
      }
      .toolbar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        border-bottom: 1px solid var(--border);
      }
      .toolbar .grow {
        flex: 1;
        display: flex;
        gap: 0.5rem;
      }
      .doc-meta {
        padding: 0.75rem 0.9rem;
        border-bottom: 1px solid var(--border);
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 0.75rem;
      }
      .doc-title {
        font-weight: 600;
        margin: 0;
        line-height: 1.3;
        font-size: 26px;
      }
      .viewer-body {
        display: grid;
        grid-template-columns: 240px 1fr;
        height: 100%;
        overflow: hidden;
      }
      .outline {
        border-right: 1px solid var(--border);
        padding: 0.75rem;
        overflow: auto;
      }
      .outline h4 {
        margin: 0 0 0.5rem 0;
        font-size: 0.95rem;
        opacity: 0.75;
      }
      .outline .ol {
        display: grid;
        gap: 0.4rem;
      }
      .outline .ol button {
        text-align: left;
        width: 100%;
        padding: 0.35rem 0.4rem;
        border-radius: 8px;
      }
      .doc {
        overflow: auto;
        padding: 1rem 1.25rem 2rem;
        line-height: 1.6;
      }
      /* Chat */
      aside.chat {
        grid-area: chat;
        border-left: 1px solid var(--border);
        display: grid;
        grid-template-rows: var(--toolbar-h) 1fr auto;
      }
      .chat-head {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.5rem 0.75rem;
        border-bottom: 1px solid var(--border);
      }
      .chat-body {
        overflow: auto;
        padding: 0.75rem;
        display: grid;
        gap: 0.6rem;
      }
      .chat-input {
        border-top: 1px solid var(--border);
        padding: 0.6rem 0.75rem;
        display: flex;
        gap: 0.5rem;
        align-items: flex-end;
      }
      textarea#qaInput {
        width: 100%;
        min-height: 44px;
        max-height: 140px;
        resize: vertical;
        padding: 0.55rem 0.65rem;
        line-height: 1.4;
      }
      .sr-only {
        position: absolute !important;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
      /* Topbar nav */
      .nav {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .links {
        display: flex;
        gap: 6px;
        align-items: center;
      }
      .links a {
        color: var(--text);
        text-decoration: none;
        padding: 8px 12px;
        border-radius: 10px;
        border: 1px solid transparent;
      }
      .links a:hover {
        border-color: var(--border);
        background: color-mix(in hsl, var(--card) 80%, transparent);
      }
      .links a.active {
        border-color: var(--border);
        background: linear-gradient(
          90deg,
          color-mix(in hsl, var(--card) 90%, transparent),
          color-mix(in hsl, var(--elev) 90%, transparent)
        );
      }
      @media (max-width: 1100px) {
        :root {
          --chat-w: 340px;
          --sidebar-w: 280px;
        }
      }
      @media (max-width: 900px) {
        .layout {
          grid-template-columns: 1fr;
          grid-template-rows: auto auto auto 1fr;
          grid-template-areas: "topbar" "sidebar" "viewer" "chat";
        }
        aside.sidebar,
        aside.chat {
          height: 45dvh;
        }
        .viewer-body {
          grid-template-columns: 1fr;
        }
        .outline {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <div class="layout">
      <!-- Top Bar with brand + nav + theme -->
      <header class="topbar" role="banner">
        <div class="nav">
          <a class="brand" href="/index.html"
            ><img src="/logo.svg" alt="Worksy AI"
          /></a>
          <nav class="links">
            <a href="/index.html">Chat</a>
            <a href="/lectures.html" class="active">Lectures</a>
            <a href="/research.html">Research</a>
            <a href="/admin.html">Admin</a>
          </nav>
        </div>
        <div class="actions">
          <button
            id="themeToggle"
            title="Toggle theme"
            aria-label="Toggle theme"
          >
            Theme
          </button>
        </div>
      </header>

      <!-- Sidebar: upload + list -->
      <aside class="sidebar" aria-label="Your lectures">
        <div class="upload">
          <strong>Upload lecture (PDF)</strong>
          <input id="titleInput" type="text" placeholder="Optional title" />
          <div class="row">
            <input id="fileInput" type="file" accept="application/pdf" />
            <button id="uploadBtn" class="primary">Upload</button>
          </div>
          <small id="uploadStatus" class="doc-subtle"></small>
        </div>

        <div class="field">
          <input
            id="lectureSearch"
            type="text"
            placeholder="Filter lectures…"
            autocomplete="off"
          />
          <button
            id="refreshLectures"
            title="Refresh list"
            aria-label="Refresh list"
          >
            ↻
          </button>
        </div>
        <div
          id="lectureList"
          class="list"
          role="listbox"
          aria-label="Lecture list"
        >
          <div class="list-item">No lectures yet.</div>
        </div>
        <div class="field" aria-live="polite">
          <small id="lectureMeta" class="doc-subtle"></small>
        </div>
      </aside>

      <!-- Viewer -->
      <section class="viewer" aria-label="Lecture viewer">
        <div class="toolbar" role="toolbar" aria-label="Document actions">
          <div class="grow">
            <input
              id="findInDoc"
              type="text"
              placeholder="Find in lecture…"
              aria-label="Find in lecture"
            />
            <button
              id="clearFind"
              title="Clear search"
              aria-label="Clear search"
            >
              Clear
            </button>
          </div>
          <button
            id="summariseBtn"
            class="primary"
            aria-label="Summarise this lecture"
          >
            Summarise
          </button>
          <span
            id="busy"
            class="doc-subtle"
            aria-live="polite"
            style="display: none"
            >Working…</span
          >
        </div>

        <div class="doc-meta">
          <h1 id="lectureTitle" class="doc-title">Open a lecture</h1>
          <span id="lectureStats" class="doc-subtle"></span>
        </div>

        <div class="viewer-body">
          <nav class="outline" aria-label="Outline">
            <h4>Outline</h4>
            <div id="outlineList" class="ol"></div>
          </nav>

          <article id="lectureContent" class="doc" aria-label="Lecture content">
            <p class="doc-subtle">
              Choose a lecture from the left. You can summarise it or ask
              questions on the right — answers will use only this lecture.
            </p>
          </article>
        </div>
      </section>

      <!-- Chat -->
      <aside class="chat" aria-label="Questions about this lecture">
        <div class="chat-head">
          <strong>Ask about this lecture</strong>
          <span class="doc-subtle">Context: current lecture only</span>
        </div>
        <div id="qaThread" class="chat-body" aria-live="polite"></div>
        <form id="qaForm" class="chat-input">
          <label for="qaInput" class="sr-only">Your question</label>
          <textarea
            id="qaInput"
            placeholder="Ask a question… (Enter to send, Shift+Enter for a new line)"
          ></textarea>
          <button
            id="qaSend"
            type="submit"
            class="primary"
            aria-label="Send question"
          >
            Send
          </button>
        </form>
      </aside>
    </div>

    <script src="/theme.js" defer></script>
    <script src="/lectures.js" type="module" defer></script>
  </body>
</html>
